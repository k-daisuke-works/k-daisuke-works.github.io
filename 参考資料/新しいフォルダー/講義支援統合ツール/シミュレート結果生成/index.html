<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœ ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Sans+JP:wght@400;500;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            --card-bg: rgba(255, 255, 255, 0.05);
            --card-border: rgba(255, 255, 255, 0.1);
            --text-color: #f1f5f9;
            --accent-color: #38bdf8;
            --danger-color: #f43f5e;
            --warning-color: #fbbf24;
            --success-color: #10b981;
        }

        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            background: var(--bg-gradient);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Views */
        #view-input {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
            box-sizing: border-box;
            animation: fadeIn 0.5s ease forwards;
        }

        #view-slides {
            width: 100%;
            display: none;
            /* åˆæœŸã¯éè¡¨ç¤º */
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
            box-sizing: border-box;
            animation: fadeIn 0.5s ease forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-weight: 700;
            margin-bottom: 30px;
            text-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            letter-spacing: 1px;
            font-size: 2.5rem;
            color: #ffffff;
            text-align: center;
        }

        /* -------------------------------------
           Input View Styles
           ------------------------------------- */
        .input-container {
            width: 100%;
            max-width: 800px;
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--card-border);
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            box-sizing: border-box;
        }

        .input-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            border-bottom: 1px solid var(--card-border);
            padding-bottom: 15px;
        }

        .input-header h2 {
            margin: 0;
            color: var(--accent-color);
            font-size: 1.6rem;
        }

        .step-group {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            display: none;
            /* åˆæœŸã¯éè¡¨ç¤º */
            animation: fadeInStep 0.5s ease forwards;
        }

        .step-group.active {
            display: flex;
            flex-direction: column;
        }

        @keyframes fadeInStep {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            gap: 12px;
        }

        .step-badge {
            background: var(--accent-color);
            color: #0f172a;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .step-title-text {
            font-size: 1.3rem;
            font-weight: bold;
            color: #e0f2fe;
        }

        textarea {
            width: 100%;
            min-height: 180px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #ffffff;
            padding: 15px;
            font-family: inherit;
            font-size: 1.05rem;
            line-height: 1.6;
            resize: vertical;
            transition: border-color 0.3s, box-shadow 0.3s;
            box-sizing: border-box;
            margin-bottom: 15px;
        }

        textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.3);
        }

        textarea::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        /* Buttons */
        .btn {
            background: var(--accent-color);
            color: #0f172a;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1.05rem;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:hover {
            background: #7dd3fc;
            transform: translateY(-2px);
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-outline {
            background: transparent;
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.3);
            font-size: 0.9rem;
            padding: 8px 16px;
        }

        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .btn-next-step {
            background: transparent;
            color: var(--accent-color);
            border: 2px dashed var(--accent-color);
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
        }

        .btn-next-step:hover {
            background: rgba(56, 189, 248, 0.1);
            color: #7dd3fc;
        }

        .btn-generate {
            width: 100%;
            padding: 18px;
            font-size: 1.3rem;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
            margin-top: 10px;
            margin-bottom: 20px;
        }

        .btn-generate:hover {
            background: linear-gradient(135deg, #34d399, #10b981);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.6);
        }

        /* -------------------------------------
           Slides View Styles
           ------------------------------------- */
        .slides-top-bar {
            width: 100%;
            max-width: 1200px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid var(--card-border);
            box-sizing: border-box;
            flex-wrap: wrap;
            gap: 15px;
        }

        .btn-back {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .btn-back:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .btn-print {
            background: #10b981;
            color: #fff;
        }

        .btn-print:hover {
            background: #059669;
        }

        .toggle-container {
            display: flex;
            align-items: center;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 30px;
            padding: 5px;
        }

        .toggle-btn {
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            color: rgba(255, 255, 255, 0.6);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toggle-btn.active {
            background: var(--accent-color);
            color: #0f172a;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .slide-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
            width: 100%;
            max-width: 900px;
        }

        .slide {
            background: #ffffff;
            color: #1e293b;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            animation: slideIn 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            page-break-inside: avoid;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(40px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .slide-header {
            font-size: 1.8rem;
            font-weight: 700;
            color: #0f172a;
            border-bottom: 4px solid var(--accent-color);
            padding-bottom: 15px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            line-height: 1.3;
        }

        .slide-badge {
            display: inline-block;
            padding: 8px 18px;
            border-radius: 30px;
            font-weight: bold;
            font-size: 1.1rem;
            color: #fff;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        }

        .bg-danger {
            background: var(--danger-color);
        }

        .bg-warning {
            background: var(--warning-color);
        }

        .bg-success {
            background: var(--success-color);
        }

        .bg-secondary {
            background: #64748b;
        }

        .slide-section-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #0284c7;
            margin-bottom: 15px;
            background: #f0f9ff;
            padding: 10px 15px;
            border-radius: 8px;
            border-left: 5px solid #0284c7;
        }

        .slide-text-block {
            line-height: 1.7;
            margin-bottom: 15px;
            font-size: 1.15rem;
            color: #334155;
            display: flex;
            align-items: flex-start;
            flex-wrap: wrap;
        }

        .slide-text {
            flex: 1;
            margin: 0;
            white-space: pre-wrap;
        }

        .score {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: #eff6ff;
            color: #2563eb;
            font-weight: bold;
            border-radius: 50%;
            min-width: 36px;
            height: 36px;
            margin-left: 12px;
            border: 2px solid #bfdbfe;
            font-size: 1rem;
        }

        /* ç‰¹å¤§æ–‡å­—ãƒ¢ãƒ¼ãƒ‰ (èª­ã‚€ç”¨) */
        body.large-text-mode .slide-container {
            max-width: 1200px;
        }

        body.large-text-mode .slide {
            padding: 50px;
        }

        body.large-text-mode .slide-header {
            font-size: 2.5rem;
            border-bottom-width: 6px;
            padding-bottom: 20px;
            margin-bottom: 35px;
        }

        body.large-text-mode .slide-badge {
            font-size: 1.5rem;
            padding: 10px 24px;
        }

        body.large-text-mode .slide-section-title {
            font-size: 1.8rem;
            padding: 15px 20px;
            border-left-width: 6px;
            margin-bottom: 25px;
        }

        body.large-text-mode .slide-text-block {
            font-size: 1.6rem;
            line-height: 1.8;
            margin-bottom: 25px;
        }

        body.large-text-mode .score {
            min-width: 48px;
            height: 48px;
            font-size: 1.4rem;
            border-width: 3px;
        }

        /* Slide Tabs */
        .slide-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .slide-tab {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid var(--card-border);
            color: rgba(255, 255, 255, 0.7);
            padding: 12px 30px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.15rem;
            transition: all 0.3s ease;
        }

        .slide-tab:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .slide-tab.active {
            background: var(--accent-color);
            color: #0f172a;
            box-shadow: 0 4px 15px rgba(56, 189, 248, 0.4);
        }

        .slide-wrapper {
            display: none;
            width: 100%;
        }

        .slide-wrapper.active {
            display: block;
            animation: fadeIn 0.4s ease forwards;
        }

        /* å°åˆ·ç”¨ */
        @media print {
            body {
                background: white !important;
                color: black !important;
                padding: 0;
                margin: 0;
            }

            #view-input,
            .slides-top-bar,
            .next-action-container,
            h1 {
                display: none !important;
            }

            #view-slides {
                display: flex !important;
                padding: 0 !important;
            }

            .slide-tabs {
                display: none !important;
            }

            .slide-wrapper:not(.active) {
                display: none !important;
            }

            .slide-wrapper.active {
                display: block !important;
            }

            .slide-container {
                max-width: 100% !important;
                gap: 0;
            }

            .slide {
                box-shadow: none !important;
                border: 2px solid #cbd5e1 !important;
                border-radius: 0 !important;
                break-inside: avoid;
                page-break-inside: avoid;
            }
        }
    </style>
</head>

<body>

    <div id="view-input">
        <h1>ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒˆãƒ©ãƒƒã‚«ãƒ¼</h1>

        <div class="input-container">
            <div class="input-header">
                <h2>ï¿½ å…¥åŠ›ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h2>
                <button class="btn btn-outline" id="btn-load-sample">ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›</button>
            </div>

            <div id="input-flow">
                <!-- Step 1: åˆæœŸå¯¾å¿œ -->
                <div class="step-group active" id="group-init">
                    <div class="step-header">
                        <div class="step-badge">1</div>
                        <div class="step-title-text">åˆæœŸå¯¾å¿œã®è¨˜éŒ²</div>
                    </div>
                    <textarea id="input-init" placeholder="åˆæœŸå¯¾å¿œã®ãƒ†ã‚­ã‚¹ãƒˆã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„..."></textarea>
                    <button class="btn btn-next-step" id="btn-next-mid">ï¼‹ ä¸­é–“å¯¾å¿œã‚’å…¥åŠ›ã™ã‚‹</button>
                </div>

                <!-- Step 2: ä¸­é–“å¯¾å¿œ (æœ€åˆã¯éè¡¨ç¤º) -->
                <div class="step-group" id="group-mid">
                    <div class="step-header">
                        <div class="step-badge">2</div>
                        <div class="step-title-text">ä¸­é–“å¯¾å¿œã®è¨˜éŒ²</div>
                    </div>
                    <textarea id="input-mid" placeholder="ä¸­é–“å¯¾å¿œã®ãƒ†ã‚­ã‚¹ãƒˆã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„..."></textarea>
                    <button class="btn btn-next-step" id="btn-next-final">ï¼‹ æœ€çµ‚å¯¾å¿œã‚’å…¥åŠ›ã™ã‚‹</button>
                </div>

                <!-- Step 3: æœ€çµ‚å¯¾å¿œ (æœ€åˆã¯éè¡¨ç¤º) -->
                <div class="step-group" id="group-final">
                    <div class="step-header">
                        <div class="step-badge">3</div>
                        <div class="step-title-text">æœ€çµ‚å¯¾å¿œã®è¨˜éŒ²</div>
                    </div>
                    <textarea id="input-final" placeholder="æœ€çµ‚å¯¾å¿œã®ãƒ†ã‚­ã‚¹ãƒˆã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„..."></textarea>
                </div>
            </div>

            <!-- Generate Button -->
            <button class="btn btn-generate" id="btn-generate">âœ¨ å…¥åŠ›å†…å®¹ã‹ã‚‰ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹</button>
        </div>
    </div>

    <div id="view-slides">
        <div class="slides-top-bar">
            <button class="btn btn-back" id="btn-back">â¬…ï¸ å…¥åŠ›ç”»é¢ã«æˆ»ã‚‹</button>

            <div class="toggle-container">
                <div class="toggle-btn active" id="toggle-normal">ğŸ“‘ é€šå¸¸ã‚µã‚¤ã‚º (å°åˆ·ç”¨)</div>
                <div class="toggle-btn" id="toggle-large">ğŸ‘“ ç‰¹å¤§ã‚µã‚¤ã‚º (èª­ã‚€ç”¨)</div>
            </div>

            <button class="btn btn-print" id="btn-print">ğŸ–¨ï¸ ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’å°åˆ·ã™ã‚‹</button>
        </div>

        <div class="slide-container" id="slide-container">
            <!-- Slides will be generated here -->
        </div>
    </div>

    <script>
        // DOM Elements
        const viewInput = document.getElementById('view-input');
        const viewSlides = document.getElementById('view-slides');

        const inputInit = document.getElementById('input-init');
        const inputMid = document.getElementById('input-mid');
        const inputFinal = document.getElementById('input-final');

        const groupMid = document.getElementById('group-mid');
        const groupFinal = document.getElementById('group-final');
        const btnNextMid = document.getElementById('btn-next-mid');
        const btnNextFinal = document.getElementById('btn-next-final');

        const btnGenerate = document.getElementById('btn-generate');
        const btnBack = document.getElementById('btn-back');
        const slideContainer = document.getElementById('slide-container');

        const btnLoadSample = document.getElementById('btn-load-sample');
        const btnPrint = document.getElementById('btn-print');
        const toggleNormal = document.getElementById('toggle-normal');
        const toggleLarge = document.getElementById('toggle-large');

        // Sample Data
        const sampleInit = `ã€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœï¼š4ãƒ¶æœˆå¾Œã€‘\n\nåˆ¤å®š: C: æ‚ªåŒ–\n\n1. ç¾å ´ã®å¤‰åŒ–ï¼ˆFactï¼‰\n\næ¯æ—¥ç—…å®¤ã¸è¶³ã‚’é‹ã³æ—¥å¸¸ä¼šè©±ã‚’è©¦ã¿ãŸãŒã€Cæ°ã¯ã€Œå®¶ã®ã“ã¨ãŒå¿ƒé…ã§ãã‚Œã©ã“ã‚ã§ã¯ãªã„ã€ã¨ç„¦ç‡¥æ„Ÿã‚’å‹Ÿã‚‰ã›ã€ä¼šè©±ãŒæ·±ã¾ã‚‰ãªã„çŠ¶æ…‹ãŒç¶šã„ãŸ ã€‚\n+1\n\né¢ä¼šã«æ¥ãŸå¤«ï¼ˆDæ°ï¼‰ã¯ã€é »ç¹ã«æ¥è§¦ã™ã‚‹MSWã‚’ã€Œé€€é™¢ã‚’å»¶ã°ã—ã¦ã‚µãƒ¼ãƒ“ã‚¹ã‚’å£²ã‚Šè¾¼ã‚‚ã†ã¨ã—ã¦ã„ã‚‹æ¥­è€…ã€ã¨è¦‹ãªã—ã€å¼·ã„è­¦æˆ’å¿ƒã‚’éœ²ã‚ã«ã—ãŸ ã€‚\n\nMSWãŒæ—¥å¸¸ä¼šè©±ã®ä¸­ã§ã€Œå®¶ã§ã®ç”Ÿæ´»ã€ã«è§¦ã‚Œã‚‹ãŸã³ã€Cæ°ã¯ã€Œå®Œç’§ã«ã‚„ã‚‰ãªã‘ã‚Œã°ã€ã¨ã„ã†å¼·è¿«çš„ãªå¿ƒç†ãƒãƒªã‚¢ï¼ˆHï¼‰ã‚’åˆºæ¿€ã•ã‚Œã€ãƒªãƒãƒ“ãƒªã¸ã®æ„æ¬²ãŒé€†ã«ä½ä¸‹ã—ãŸ ã€‚\n+1\n\n2. ç™ºç”Ÿã—ãŸæ–°ãŸãªèª²é¡Œï¼ˆNext Challengeï¼‰\n\nå¤«ã‹ã‚‰ã€Œã—ã¤ã“ã„ã€‚ã‚‚ã†ç›¸è«‡å“¡ã¨ã¯è©±ã•ãªã„ã€‚ã•ã£ã•ã¨å®¶ã«å¸°ã›ã€ã¨æ‹’çµ¶ã•ã‚Œã€çª“å£ãŒé–‰ã–ã•ã‚ŒãŸã€‚\n\nä»‹å…¥ãŒã€Œæœ¬äººã¸ã®æ—¥å¸¸ä¼šè©±ã€ã«çµ‚å§‹ã—ãŸã“ã¨ã§ã€ç–²å¼Šã—ã¦ã„ã‚‹é•·å¥³ï¼ˆEæ°ï¼‰ã®ã‚­ãƒ¼ãƒ‘ãƒ¼ã‚½ãƒ³ã¨ã—ã¦ã®ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆã‚„ã€å¤«ã®ä¾¡å€¤è¦³ã¸ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒæ”¾ç½®ã•ã‚Œã€é€€é™¢å¾Œã®ã€Œä»‹è­·å…±å€’ã‚Œã€ãƒªã‚¹ã‚¯ãŒã‚ˆã‚Šæ·±åˆ»åŒ–ã—ãŸ ã€‚\n+1`;
        const sampleMid = `ã€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœï¼š8ãƒ¶æœˆå¾Œã€‘\n\nåˆ¤å®š: D: æ±ºè£‚\n\n1. ç¾å ´ã®å¤‰åŒ–ï¼ˆFactï¼‰\n\nMSWãŒç²˜ã‚Šå¼·ãè¨ªå•ã‚’ç¶šã‘ãŸã‚‚ã®ã®ã€å¤«ï¼ˆDæ°ï¼‰ã®æ…‹åº¦ã¯ç¡¬åŒ–ã®ä¸€é€”ã‚’ãŸã©ã‚Šã€ã¤ã„ã«ã€Œç›¸è«‡å“¡ã‚’ä»£ãˆã‚ã€äºŒåº¦ã¨æ¥ã‚‹ãªã€ã¨ç—…é™¢å´ã«æ­£å¼ãªã‚¯ãƒ¬ãƒ¼ãƒ ãŒå…¥ã£ãŸ ã€‚\n+3\n\næœ¬äººï¼ˆCæ°ï¼‰ã¯ç—…é™¢å†…ã§ã€Œæ—©ãå¸°ã£ã¦ã”é£¯ã‚’ä½œã‚‰ãªãã‚ƒã€ã¨ã„ã†ç„¦ç‡¥æ„Ÿã‹ã‚‰å‹æ‰‹ã«ç«‹ã¡ä¸ŠãŒã‚ã†ã¨ã—ã¦è»¢å€’ã‚’ç¹°ã‚Šè¿”ã—ã€å¤§è…¿éª¨ã‚’éª¨æŠ˜ã€‚è‡ªå®…å¾©å¸°ã¯çµ¶æœ›çš„ã¨ãªã£ãŸ ã€‚\n+2\n\né•·å¥³ï¼ˆEæ°ï¼‰ã¯ã€çˆ¶è¦ªã®æ€’ã‚Šã¨æ¯è¦ªã®å†éª¨æŠ˜ã®æ¿æŒŸã¿ã«ãªã‚Šã€å¿ƒèº«ã®é™ç•Œã‚’è¶…ãˆã¦æ²ˆé»™ã€‚ç›¸è«‡çª“å£ã‹ã‚‰ã‚‚å§¿ã‚’æ¶ˆã—ãŸ ã€‚\n+2\n\n2. ç™ºç”Ÿã—ãŸæ–°ãŸãªèª²é¡Œï¼ˆNext Challengeï¼‰\n\næœ¬äººã®ADLãŒå¤§å¹…ã«ä½ä¸‹ã—ã€å½“åˆã®ã€Œè‡ªå®…å¾©å¸°ã€ã¨ã„ã†ç›®æ¨™ãŒç‰©ç†çš„ã«ä¸å¯èƒ½ã¨ãªã£ãŸ ã€‚\n\nå®¶æ—ã®ã€Œç›¸è«‡å“¡ã¸ã®ä¸ä¿¡æ„Ÿã€ãŒé ‚ç‚¹ã«é”ã—ã¦ãŠã‚Šã€ä»Šå¾Œã®æ–½è¨­å…¥æ‰€ç­‰ã®èª¿æ•´ã«ãŠã„ã¦ã€æ³•çš„æ‰‹æ®µï¼ˆæˆå¹´å¾Œè¦‹åˆ¶åº¦ã®æ¤œè¨ç­‰ï¼‰ã‚’å«ã‚ãŸæ¥µã‚ã¦å›°é›£ãªå±€é¢ã‚’è¿ãˆã¦ã„ã‚‹ ã€‚\n+2`;
        const sampleFinal = `ã€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœï¼š12ãƒ¶æœˆå¾Œï¼ˆæœ€çµ‚å ±å‘Šï¼‰ã€‘\n\nåˆ¤å®š: D: æ±ºè£‚ï¼ˆæ”¯æ´å¤±æ•—ï¼‰\n\n1. ç¾å ´ã®å¤‰åŒ–ï¼ˆFactï¼‰\n\né–¢ä¿‚æ§‹ç¯‰ã«ã“ã ã‚ã‚Šã€å®¢è¦³çš„ãªãƒªã‚¹ã‚¯ï¼ˆå†è»¢å€’ãƒ»éª¨æŠ˜ï¼‰ã‚’ã€Œäº‹å®Ÿã€ã¨ã—ã¦å®¶æ—ã«çªãã¤ã‘ãªã‹ã£ãŸãŸã‚ã€å¤«ï¼ˆDæ°ï¼‰ã¯ã€Œç—…é™¢ã®ä¸æ‰‹éš›ã§å¦»ãŒæ­©ã‘ãªããªã£ãŸã€ã¨ä¸»å¼µã—ã€æå®³è³ å„Ÿã‚’æ±‚ã‚ã¦ç—…é™¢ã‚’æè¨´ã™ã‚‹äº‹æ…‹ã¨ãªã£ãŸ ã€‚\n+1\n\né•·å¥³ï¼ˆEæ°ï¼‰ã¯é‡åº¦ã®æŠ‘ã†ã¤çŠ¶æ…‹ã«é™¥ã‚Šã€å®Ÿå®¶ã‚’é›¢ã‚Œã¦å¤±è¸ªã€‚ä»‹è­·ã®æ‹…ã„æ‰‹ãŒå®Œå…¨ã«æ¶ˆå¤±ã—ãŸã€‚\n\næœ¬äººï¼ˆCæ°ï¼‰ã¯éª¨æŠ˜å¾Œã®ãƒªãƒãƒ“ãƒªã‚‚æ‹’å¦ã—ã€å¯ãŸãã‚ŠçŠ¶æ…‹ã§èªçŸ¥ç—‡ãŒé€²è¡Œã€‚ã€Œæ—©ãå¸°ã£ã¦é£Ÿäº‹ã‚’â€¦ã€ã¨ã„ã†ã†ã‚è¨€ã®ã¿ã‚’ç¹°ã‚Šè¿”ã—ã¦ã„ã‚‹ã€‚\n\n2. ç™ºç”Ÿã—ãŸæ–°ãŸãªèª²é¡Œï¼ˆNext Challengeï¼‰\n\nã‚­ãƒ¼ãƒ‘ãƒ¼ã‚½ãƒ³ï¼ˆé•·å¥³ï¼‰ã®æ¶ˆå¤±ã¨ã€å¤«ã®æ”»æ’ƒæ€§ã«ã‚ˆã‚Šã€ç‰¹é¤Šå…¥æ‰€ç­‰ã®å¥‘ç´„è¡Œç‚ºãŒä¸€åˆ‡é€²ã‚ã‚‰ã‚Œãªã„ã€‚\n\nã€Œé–¢ä¿‚æ€§ã€ã¨ã„ã†ã‚¢ãƒŠãƒ­ã‚°ã§æ›–æ˜§ãªæƒ…å ±ã‚’å„ªå…ˆã—ã€æ³•çš„ãƒ»åˆ¶åº¦çš„ãªã€Œãƒ‡ã‚¸ã‚¿ãƒ«ï¼ˆç¢ºå®šï¼‰ã€ãªæ‰‹ç¶šãã‚’æ€ ã£ãŸçµæœã€æœ¬äººã®ç”Ÿå­˜æ¨©ãŒè„…ã‹ã•ã‚Œã‚‹æ·±åˆ»ãªå€«ç†æ€§å•é¡Œã«ç™ºå±•ã—ãŸ ã€‚\n+1`;

        // Workflow Events
        btnNextMid.addEventListener('click', () => {
            groupMid.classList.add('active');
            btnNextMid.style.display = 'none';
            setTimeout(() => inputMid.focus(), 100);
        });

        btnNextFinal.addEventListener('click', () => {
            groupFinal.classList.add('active');
            btnNextFinal.style.display = 'none';
            setTimeout(() => inputFinal.focus(), 100);
        });

        // Load Sample
        btnLoadSample.addEventListener('click', () => {
            // Expand all groups
            groupMid.classList.add('active');
            groupFinal.classList.add('active');
            btnNextMid.style.display = 'none';
            btnNextFinal.style.display = 'none';

            inputInit.value = sampleInit;
            inputMid.value = sampleMid;
            inputFinal.value = sampleFinal;
        });

        // Generate Slides & Switch View
        btnGenerate.addEventListener('click', () => {
            generateSlides();
            viewInput.style.display = 'none';
            viewSlides.style.display = 'flex';
            window.scrollTo(0, 0);
        });

        // Go Back to Input
        btnBack.addEventListener('click', () => {
            viewSlides.style.display = 'none';
            viewInput.style.display = 'flex';
        });

        // Mode Toggles
        toggleNormal.addEventListener('click', () => {
            document.body.classList.remove('large-text-mode');
            toggleNormal.classList.add('active');
            toggleLarge.classList.remove('active');
        });

        toggleLarge.addEventListener('click', () => {
            document.body.classList.add('large-text-mode');
            toggleLarge.classList.add('active');
            toggleNormal.classList.remove('active');
        });

        // Print
        btnPrint.addEventListener('click', () => window.print());

        // Parse Text
        function parseTextToHTML(text) {
            if (!text || !text.trim()) return null;

            let html = '';
            // Fix: split by newline properly
            const lines = text.split('\n');
            let inSection = false;
            let currentTitle = 'è¨˜éŒ²';
            let currentBadge = '';
            let contentHtml = '';

            let currentParagraph = '';

            const flushParagraph = (score = null) => {
                if (currentParagraph.trim()) {
                    let pContent = `<div class="slide-text">${currentParagraph.trim()}</div>`;
                    if (score) {
                        contentHtml += `<div class="slide-text-block">${pContent}<span class="score">+${score}</span></div>`;
                    } else {
                        contentHtml += `<div class="slide-text-block">${pContent}</div>`;
                    }
                } else if (score) {
                    contentHtml += `<div class="slide-text-block"><span class="score">+${score}</span></div>`;
                }
                currentParagraph = '';
            };

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();

                const titleMatch = line.match(/^ã€(.*?)ã€‘$/);
                if (titleMatch) {
                    currentTitle = titleMatch[1];
                    continue;
                }

                const judgeMatch = line.match(/^åˆ¤å®š:?\s*(.*)$/);
                if (judgeMatch) {
                    const status = judgeMatch[1];
                    let badgeClass = 'bg-secondary';
                    if (status.includes('æ‚ªåŒ–') || status.includes('æ±ºè£‚') || status.includes('å¤±æ•—') || status.includes('D:') || status.includes('C:')) {
                        badgeClass = 'bg-danger';
                    } else if (status.includes('ç¶­æŒ') || status.includes('B:')) {
                        badgeClass = 'bg-warning';
                    } else if (status.includes('æ”¹å–„') || status.includes('A:')) {
                        badgeClass = 'bg-success';
                    }
                    currentBadge = `<span class="slide-badge ${badgeClass}">åˆ¤å®š: ${status}</span>`;
                    continue;
                }

                const sectionMatch = line.match(/^(\d+\.|[â‘ â‘¡â‘¢â‘£â‘¤])\s*(.*)$/);
                if (sectionMatch && (line.includes('Fact') || line.includes('Challenge') || line.includes('å¤‰åŒ–') || line.includes('èª²é¡Œ'))) {
                    flushParagraph();
                    if (inSection) contentHtml += '</div>';
                    inSection = true;
                    contentHtml += `<div class="slide-section"><h3 class="slide-section-title">${line}</h3>`;
                    continue;
                }

                const scoreMatch = line.match(/^\+(\d+)$/);
                if (scoreMatch) {
                    flushParagraph(scoreMatch[1]);
                    continue;
                }

                if (line === '') {
                    flushParagraph();
                    continue;
                }

                currentParagraph += (currentParagraph ? '<br>' : '') + line;
            }

            flushParagraph();
            if (inSection) contentHtml += '</div>';

            return `
                <div class="slide-header">
                    <span>${currentTitle}</span>
                    ${currentBadge}
                </div>
                <div class="slide-content">
                    ${contentHtml}
                </div>
            `;
        }

        function generateSlides() {
            const slideData = [];
            let currentDepth = 1;

            if (inputInit.value) { slideData.push({ title: 'â‘  åˆæœŸå¯¾å¿œ', text: inputInit.value, type: 1 }); }
            if (groupMid.classList.contains('active') && inputMid.value) { slideData.push({ title: 'â‘¡ ä¸­é–“å¯¾å¿œ', text: inputMid.value, type: 2 }); currentDepth = 2; }
            if (groupFinal.classList.contains('active') && inputFinal.value) { slideData.push({ title: 'â‘¢ æœ€çµ‚å¯¾å¿œ', text: inputFinal.value, type: 3 }); currentDepth = 3; }

            slideContainer.innerHTML = '';

            if (slideData.length === 0) {
                slideContainer.innerHTML = '<div style="text-align:center; padding:50px; font-size:1.5rem; color:#fff;">å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ç”»é¢ä¸Šéƒ¨ã®ãƒœã‚¿ãƒ³ã‹ã‚‰æˆ»ã£ã¦å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</div>';
                return;
            }

            // Create Tabs area
            const tabsDiv = document.createElement('div');
            tabsDiv.className = 'slide-tabs';
            slideContainer.appendChild(tabsDiv);

            const wrappers = [];

            slideData.forEach((data, index) => {
                // Create Tab button
                const tab = document.createElement('div');
                tab.className = 'slide-tab';
                tab.textContent = data.title;
                tabsDiv.appendChild(tab);

                // Create Wrapper for this slide
                const wrapper = document.createElement('div');
                wrapper.className = 'slide-wrapper';

                const parsed = parseTextToHTML(data.text);
                if (parsed) {
                    const slide = document.createElement('div');
                    slide.className = 'slide';
                    slide.innerHTML = parsed;
                    wrapper.appendChild(slide);
                }

                // Add Next Step Button in the wrapper below the slide
                const nextActionContainer = document.createElement('div');
                nextActionContainer.className = 'next-action-container';
                nextActionContainer.style.textAlign = 'center';
                nextActionContainer.style.marginTop = '20px';
                nextActionContainer.style.marginBottom = '20px';

                if (data.type === 1) {
                    if (currentDepth === 1) {
                        nextActionContainer.innerHTML = '<button class="btn" style="background:#38bdf8; font-size:1.15rem; padding: 15px 30px; box-shadow: 0 4px 15px rgba(56, 189, 248, 0.3);">ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼šä¸­é–“å¯¾å¿œã‚’å…¥åŠ›ã™ã‚‹</button>';
                        nextActionContainer.querySelector('button').addEventListener('click', () => {
                            viewSlides.style.display = 'none';
                            viewInput.style.display = 'flex';
                            groupMid.classList.add('active');
                            btnNextMid.style.display = 'none';
                            setTimeout(() => {
                                inputMid.focus();
                                inputMid.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            }, 100);
                        });
                        wrapper.appendChild(nextActionContainer);
                    }
                } else if (data.type === 2) {
                    if (currentDepth === 2) {
                        nextActionContainer.innerHTML = '<button class="btn" style="background:#38bdf8; font-size:1.15rem; padding: 15px 30px; box-shadow: 0 4px 15px rgba(56, 189, 248, 0.3);">ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼šæœ€çµ‚å¯¾å¿œã‚’å…¥åŠ›ã™ã‚‹</button>';
                        nextActionContainer.querySelector('button').addEventListener('click', () => {
                            viewSlides.style.display = 'none';
                            viewInput.style.display = 'flex';
                            groupFinal.classList.add('active');
                            btnNextFinal.style.display = 'none';
                            setTimeout(() => {
                                inputFinal.focus();
                                inputFinal.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            }, 100);
                        });
                        wrapper.appendChild(nextActionContainer);
                    }
                } else if (data.type === 3) {
                    nextActionContainer.innerHTML = '<div style="color: #6ee7b7; font-size: 1.3rem; font-weight: bold; padding: 20px;">ğŸ‰ å…¨ã¦ã®è¨˜éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸ</div>';
                    wrapper.appendChild(nextActionContainer);
                }

                slideContainer.appendChild(wrapper);
                wrappers.push({ tab, wrapper });

                // Click event for tab
                tab.addEventListener('click', () => {
                    wrappers.forEach(w => {
                        w.tab.classList.remove('active');
                        w.wrapper.classList.remove('active');
                    });
                    tab.classList.add('active');
                    wrapper.classList.add('active');
                });
            });

            // Only show tabs if there is more than 1 slide
            if (slideData.length <= 1) {
                tabsDiv.style.display = 'none';
            }

            // Click the last tab by default (the one just submitted)
            if (wrappers.length > 0) {
                wrappers[wrappers.length - 1].tab.click();
            }
        }
    </script>
</body>

</html>